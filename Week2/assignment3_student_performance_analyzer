#include <stdio.h>
#include <string.h>
#include <stdbool.h>
#define MAX_STUDENT 100
#define NUM_SUBJECTS 3
#define GRADE_A_MIN 85
#define GRADE_B_MIN 70
#define GRADE_C_MIN 50
#define GRADE_D_MIN 35


typedef enum
{
     A = 'A',
     B = 'B',
     C = 'C',
     D = 'D',
     F = 'F'
} Grade;

typedef enum
{
     PERFORMANCE_F = 0,
     PERFORMANCE_D = 2,
     PERFORMANCE_C = 3,
     PERFORMANCE_B = 4,
     PERFORMANCE_A = 5
} PerformanceStars;

typedef struct
{
     int rollNumber;
     char name[50];
     int marks[NUM_SUBJECTS];
} Student;

void inputStudentDetails(Student students[], int *totalStudents);
void printStudentData(Student students[], int totalStudents);
void sortStudentsByRoll(Student students[], int totalStudents);
int calculateTotal(int subjectMarks[], int subjectCount);
float calculateAverage(int totalMarks, int subjectCount);
Grade assignGrade(float averageMarks);
void printPerformanceStar(int starCount);
void printRollNumber(Student students[], int counter, int totalStudents);
bool isValidMark(int subjectMarks[], int subjectCount);
bool isValidRollNumber(Student students[], int count, int rollNumber);
PerformanceStars mapGradeToPerformance(Grade g);

int main()
{
     int numberofStudents;
     Student students[MAX_STUDENT];

     inputStudentDetails(students, &numberofStudents);
     sortStudentsByRoll(students, numberofStudents);
     printStudentData(students, numberofStudents);

     printf("\nList of Roll Numbers : ");
     printRollNumber(students, 0, numberofStudents);
     printf("\n");

     return 0;
}

void inputStudentDetails(Student students[], int *totalStudents)
{
     scanf("%d", totalStudents);
     bool validRoll = false;
     bool validMarks = false;

     for (int index = 0; index < *totalStudents; index++)
     {
          do
          {

               scanf("%d %s %d %d %d", &students[index].rollNumber, students[index].name,
                     &students[index].marks[0], &students[index].marks[1], &students[index].marks[2]);
               validRoll = isValidRollNumber(students, index, students[index].rollNumber);
               if (!validRoll)
               {
                    printf("\n Error: Duplicate roll number! \n");
               }
               validMarks = isValidMark(students[index].marks, NUM_SUBJECTS);
               if (!validMarks)
               {
                    printf("\n Error: Marks must be between 0 and 100.\n");
               }
          } while (!validMarks || !validRoll);
     }
}

void printStudentData(Student students[], int totalStudents)
{
     for (int index = 0; index < totalStudents; index++)
     {
          int totalMarks = calculateTotal(students[index].marks, NUM_SUBJECTS);
          float averageMarks = calculateAverage(totalMarks, NUM_SUBJECTS);
          Grade grade = assignGrade(averageMarks);

          printf("\nRoll: %d\n", students[index].rollNumber);
          printf("Name: %s\n", students[index].name);
          printf("Total: %d\n", totalMarks);
          printf("Average: %.2f\n", averageMarks);
          printf("Grade: %c\n", (char)grade);

          if (grade == F)
          {
               continue;
          }
          PerformanceStars stars = mapGradeToPerformance(grade);
          printPerformanceStar(stars);
     }
}

void sortStudentsByRoll(Student students[], int totalStudents)
{
     for (int index = 0; index < totalStudents - 1; index++)
     {
          for (int index_1 = index + 1; index_1 < totalStudents; index_1++)
          {
               if (students[index].rollNumber > students[index_1].rollNumber)
               {
                    Student temporary = students[index];
                    students[index] = students[index_1];
                    students[index_1] = temporary;
               }
          }
     }
}

int calculateTotal(int subjectMarks[], int subjectCount)
{
     int total = 0;
     for (int index = 0; index < subjectCount; index++)
     {
          total += subjectMarks[index];
     }
     return total;
}

float calculateAverage(int totalMarks, int subjectCount)
{
     if (subjectCount == 0)
          return 0.0;
     return (float)totalMarks / subjectCount;
}

Grade assignGrade(float averageMarks)
{
     if (averageMarks >= GRADE_A_MIN)
          return A;
     if (averageMarks >= GRADE_B_MIN)
          return B;
     if (averageMarks >= GRADE_C_MIN)
          return C;
     if (averageMarks >= GRADE_D_MIN)
          return D;
     return F;
}

void printPerformanceStar(int starCount)
{
     printf("Performance: ");
     for (int index = 0; index < starCount; index++)
     {
          printf("*");
     }
     printf("\n");
}

void printRollNumber(Student students[], int counter, int totalStudents)
{
     if (counter >= totalStudents)
     {
          return;
     }
     printf("%d ", students[counter].rollNumber);
     printRollNumber(students, counter + 1, totalStudents);
}

bool isValidMark(int subjectMarks[], int subjectCount)
{
     for (int index = 0; index < subjectCount; index++)
     {
          if (subjectMarks[index] < 0 || subjectMarks[index] > 100)
          {
               return false;
          }
     }
     return true;
}

bool isValidRollNumber(Student students[], int count, int rollNumber)
{
     for (int index = 0; index < count; index++)
     {
          if (students[index].rollNumber == rollNumber)
          {
               return false;
          }
     }
     return true;
}

PerformanceStars mapGradeToPerformance(Grade g)
{
     switch (g)
     {
     case A:
          return PERFORMANCE_A;
     case B:
          return PERFORMANCE_B;
     case C:
          return PERFORMANCE_C;
     case D:
          return PERFORMANCE_D;
     case F:
          return PERFORMANCE_F;
     }
     return PERFORMANCE_F;
}